<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Admin Login - Exam Portal</title>
    <style>
        :root {
            --primary: #15803d; --primary-foreground: #ffffff; --card: #ffffff;
            --border: #e5e7eb; --muted: #f9fafb; --destructive: #b91c1c;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6; color: #374151;
            background-color: var(--muted); display: grid; place-items: center; min-height: 100vh;
        }
        .login-card {
            background-color: var(--card); border: 1px solid var(--border); border-radius: 0.75rem;
            padding: 2.5rem; width: 100%; max-width: 420px; text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        h1 { font-size: 1.75rem; font-weight: 700; color: var(--primary); margin-bottom: 0.75rem; }
        p { color: #4b5563; margin-bottom: 1.5rem; }
        .form-group { margin-bottom: 1.25rem; text-align: left; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.875rem; }
        .form-input {
            width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 0.375rem;
            font-size: 1rem; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .form-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 2px rgba(21, 128, 61, 0.2); }
        .btn {
            padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; font-weight: 600;
            font-size: 1rem; cursor: pointer; transition: all 0.3s ease;
            background-color: var(--primary); color: var(--primary-foreground);
            width: 100%; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;
        }
        .btn:hover:not(:disabled) { background-color: #10b981; }
        .btn:disabled { background-color: #9ca3af; cursor: not-allowed; }
        .status { margin-top: 1.5rem; font-weight: 500; min-height: 24px; text-align: center; }
        .status.success { color: var(--primary); } .status.error { color: var(--destructive); }
        .spinner {
            display: inline-block; width: 1.25rem; height: 1.25rem;
            border: 3px solid rgba(255, 255, 255, 0.3); border-top-color: var(--primary-foreground);
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="login-card">
        <h1>College Admin Portal</h1>
        <p>Please log in to manage your tests.</p>
        <form id="login-form">
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" class="form-input" required>
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" class="form-input" required>
            </div>
            <button type="submit" class="btn" id="login-btn">
                <span>Login</span>
            </button>
            <div id="login-status" class="status"></div>
        </form>
    </div>

    <script type="module">
        // Import Firebase Auth
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, setLogLevel } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // --- CONFIGURATION ---
        // !! IMPORTANT: This is the same config from your original file.
        const firebaseConfig = {
          apiKey: "AIzaSyCQ34ZAWWCMuaQ01fvX0sI-YdklK0mJ5aw",
          authDomain: "testseries-38752.firebaseapp.com",
          projectId: "testseries-38752",
          storageBucket: "testseries-38752.firebasestorage.app",
          messagingSenderId: "519384534407",
          appId: "1:519384534407:web:201265a9d703708334d722"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        setLogLevel('debug');

        const loginForm = document.getElementById('login-form');
        const loginBtn = document.getElementById('login-btn');
        const statusDiv = document.getElementById('login-status');

        // --- Authentication Listener ---
        // Checks if user is already logged in
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // If user is logged in, redirect to the main upload page
                console.log("User already logged in, redirecting to upload.html...");
                window.location.href = 'upload.html';
            } else {
                // If user is not logged in, show the login form (which is visible by default)
                console.log("No user logged in.");
            }
        });

        // --- Handle Login Form Submission ---
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            // --- NEW: Client-Side Admin Check ---
            // Check if the email address contains the case-insensitive string 'admin'
            if (!email.toLowerCase().includes('admin')) {
                setError(statusDiv, "Access Denied: Only designated admin accounts can log in.");
                // Stop the login attempt immediately
                return;
            }
            // --- END NEW CHECK ---

            setLoading(loginBtn, "Logging in...");
            
            try {
                // Sign in with Firebase Auth
                await signInWithEmailAndPassword(auth, email, password);
                // Auth listener (onAuthStateChanged) will handle the redirect
                setSuccess(statusDiv, "Success! Redirecting...");
            } catch (error) {
                console.error("Login Failed:", error.message);
                // The error message for incorrect credentials comes from Firebase, not the client-side check.
                setError(statusDiv, "Login Failed: " + error.code);
                setIdle(loginBtn, "Login");
            }
        });

        // --- UI Helper Functions ---
        function setLoading(btn, text) {
            btn.disabled = true;
            btn.innerHTML = `<div class="spinner"></div><span>${text}</span>`;
            statusDiv.textContent = '';
            statusDiv.className = 'status';
        }

        function setIdle(btn, text) {
            btn.disabled = false;
            btn.innerHTML = `<span>${text}</span>`;
        }

        function setError(statusDiv, message) {
            if (statusDiv) {
                statusDiv.textContent = message;
                statusDiv.className = 'status error';
            }
        }

        function setSuccess(statusDiv, message) {
            if (statusDiv) {
                statusDiv.textContent = message;
                statusDiv.className = 'status success';
            }
        }
    </script>
</body>
</html>
